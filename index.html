<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>NAT ç±»å‹æ£€æµ‹å·¥å…·</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 40px; background: #f4f4f4; }
    h1 { color: #333; }
    pre { background: #fff; padding: 20px; border-radius: 6px; box-shadow: 0 0 10px #ccc; white-space: pre-wrap; }
    select, button { padding: 10px; font-size: 16px; margin-right: 10px; }
  </style>
</head>
<body>
  <h1>ğŸŒ NAT ç±»å‹æ£€æµ‹å·¥å…·</h1>
  <p>è¯·é€‰æ‹©ä¸€ä¸ª STUN æœåŠ¡å™¨ï¼š</p>
  <select id="stunSelector">
    <option value="stun:stun.qq.com:3478">è…¾è®¯äº‘ï¼ˆstun.qq.comï¼‰</option>
    <option value="stun:stun.huawei.com:3478">åä¸ºäº‘ï¼ˆstun.huawei.comï¼‰</option>
    <option value="stun:stun.xten.com">Xten å…¬å…±æœåŠ¡å™¨</option>
    <option value="stun:stun.services.mozilla.com">Mozilla</option>
    <option value="stun:stun.l.google.com:19302">Googleï¼ˆå¯èƒ½æ— æ³•è¿æ¥ï¼‰</option>
  </select>
  <button onclick="runTest()">å¼€å§‹æ£€æµ‹</button>

  <pre id="output">ç­‰å¾…æ£€æµ‹...</pre>

  <script>
    function runTest() {
      const output = document.getElementById('output');
      const stunServer = document.getElementById('stunSelector').value;

      output.textContent = "æ£€æµ‹ä¸­ï¼Œè¯·ç¨ç­‰...";

      const rtc = new RTCPeerConnection({
        iceServers: [{ urls: stunServer }]
      });

      let candidates = [];

      rtc.onicecandidate = (event) => {
        if (event.candidate) {
          candidates.push(event.candidate.candidate);
        } else {
          analyzeCandidates(candidates);
        }
      };

      rtc.createDataChannel("test");
      rtc.createOffer()
        .then(offer => rtc.setLocalDescription(offer))
        .catch(err => {
          output.textContent = "åˆ›å»ºè¿æ¥å¤±è´¥ï¼š" + err;
        });

      function analyzeCandidates(candidates) {
        let host = 0, srflx = 0, relay = 0;

        candidates.forEach(candidate => {
          if (candidate.includes("typ host")) host++;
          else if (candidate.includes("typ srflx")) srflx++;
          else if (candidate.includes("typ relay")) relay++;
        });

        let natType = "æ— æ³•åˆ¤æ–­";

        if (relay > 0) {
          natType = "å¯¹ç§° NATï¼ˆSymmetric NATï¼‰æˆ– UDP è¢«é˜»æ­¢";
        } else if (srflx > 0) {
          natType = "å—é™é”¥å½¢ NAT æˆ– ç«¯å£å—é™é”¥å½¢ NAT";
        } else if (host > 0) {
          natType = "å¼€æ”¾å‹ NATï¼ˆFull Cone NATï¼‰æˆ–å…¬ç½‘ IP";
        }

        output.textContent = `ä½¿ç”¨ STUN æœåŠ¡å™¨ï¼š${stunServer}

æ£€æµ‹ç»“æœå¦‚ä¸‹ï¼š
------------------------
æœ¬åœ°å€™é€‰ï¼ˆhostï¼‰ï¼š${host} ä¸ª
æœåŠ¡å™¨åå°„ï¼ˆsrflxï¼‰ï¼š${srflx} ä¸ª
ä¸­ç»§åœ°å€ï¼ˆrelayï¼‰ï¼š${relay} ä¸ª

æ¨æµ‹ä½ çš„ NAT ç±»å‹æ˜¯ï¼š${natType}
`;
      }
    }
  </script>
</body>
</html>
