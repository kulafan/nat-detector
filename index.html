<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8" />
  <title>NAT ç±»å‹æ£€æµ‹å·¥å…·</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 40px;
      background: #f4f4f4;
    }

    h1 {
      color: #333;
    }

    pre {
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      box-shadow: 0 0 10px #ccc;
      white-space: pre-wrap;
    }

    select,
    button,
    input {
      padding: 10px;
      font-size: 16px;
      margin-right: 10px;
    }

   .function-row {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

   .nat-explanation {
      margin-top: 20px;
      background: #fff;
      padding: 15px;
      border-radius: 6px;
      box-shadow: 0 0 10px #ccc;
    }
  </style>
</head>

<body>
  <a href="https://www.kulafan.com" target="_blank">è¿”å›kulafanåšå®¢</a>
  <h1>ğŸŒ NAT ç±»å‹æ£€æµ‹å·¥å…·</h1>
  <div class="function-row">
    <p>é€‰ STUN æœåŠ¡å™¨ï¼š</p>
    <select id="stunSelector">
      <option value="stun:stun.l.google.com:19302">Google</option>
      <option value="stun:stun.qq.com:3478">è…¾è®¯äº‘</option>
      <option value="stun:stun.huawei.com:3478">åä¸ºäº‘</option>
      <option value="stun:stun.xten.com">Xten æœåŠ¡å™¨</option>
      <option value="stun:stun.services.mozilla.com">Mozilla</option>
    </select>
    <p>æˆ–è‡ªå®šï¼š</p>
    <input type="text" id="customStunServer" placeholder="STUN æœåŠ¡å™¨åœ°å€">
    <button onclick="runTest()">æ£€æµ‹</button>
    <button onclick="clearResult()">æ¸…é™¤</button>
  </div>
  <pre id="output">ç­‰å¾…æ£€æµ‹...</pre>
  <div class="nat-explanation">
    <h2>NATç±»å‹è¯´æ˜</h2>
    <p><strong>å¼€æ”¾å‹ NATï¼ˆFull Cone NATï¼‰æˆ–å…¬ç½‘IP</strong>ï¼šè®¾å¤‡å¯ç›´æ¥ä¸å¤–éƒ¨ç½‘ç»œé€šä¿¡ï¼Œå…·æœ‰è¾ƒå¥½çš„ç½‘ç»œç©¿é€æ€§ï¼Œé€‚åˆå¤§å¤šæ•°P2Påº”ç”¨å’Œåœ¨çº¿æ¸¸æˆã€‚</p>
    <p><strong>å—é™é”¥å½¢ NAT æˆ– ç«¯å£å—é™é”¥å½¢ NAT</strong>ï¼šå¤–éƒ¨è®¾å¤‡éœ€å…ˆæ”¶åˆ°å†…éƒ¨è®¾å¤‡çš„è¯·æ±‚ï¼Œæ‰èƒ½å»ºç«‹è¿æ¥ï¼Œç©¿é€æ€§ä¸­ç­‰ï¼Œéƒ¨åˆ†åº”ç”¨å¯èƒ½éœ€è¦é¢å¤–é…ç½®ã€‚</p>
    <p><strong>å¯¹ç§° NATï¼ˆSymmetric NATï¼‰æˆ– UDP è¢«é˜»æ­¢</strong>ï¼šä¸åŒç›®æ ‡åœ°å€æˆ–ç«¯å£çš„è¿æ¥éœ€é‡æ–°æ˜ å°„ï¼Œç©¿é€æ€§è¾ƒå·®ï¼Œå¯èƒ½å¯¼è‡´éƒ¨åˆ†ä¾èµ–ç½‘ç»œè¿æ¥çš„åº”ç”¨æ— æ³•æ­£å¸¸ä½¿ç”¨ã€‚</p>
  </div>

  <script>
    function runTest() {
      const output = document.getElementById('output');
      const customStun = document.getElementById('customStunServer').value;
      const stunSelector = document.getElementById('stunSelector');
      let stunServer;
      if (customStun) {
        stunServer = customStun;
      } else {
        stunServer = stunSelector.value;
      }

      output.textContent = "æ£€æµ‹ä¸­ï¼Œè¯·ç¨ç­‰...";

      const rtc = new RTCPeerConnection({
        iceServers: [{ urls: stunServer }]
      });

      let candidates = [];

      rtc.onicecandidate = (event) => {
        if (event.candidate) {
          candidates.push(event.candidate.candidate);
        } else {
          analyzeCandidates(candidates);
        }
      };

      rtc.createDataChannel("test");
      rtc.createOffer()
       .then(offer => rtc.setLocalDescription(offer))
       .catch(err => {
          output.textContent = "åˆ›å»ºè¿æ¥å¤±è´¥ï¼š" + err;
        });

      function analyzeCandidates(candidates) {
        let host = 0, srflx = 0, relay = 0;

        candidates.forEach(candidate => {
          if (candidate.includes("typ host")) host++;
          else if (candidate.includes("typ srflx")) srflx++;
          else if (candidate.includes("typ relay")) relay++;
        });

        let natType = "æ— æ³•åˆ¤æ–­";

        if (relay > 0) {
          natType = "å¯¹ç§° NAT æˆ– UDP è¢«é˜»æ­¢";
        } else if (srflx > 0) {
          natType = "å—é™é”¥å½¢ NAT æˆ– ç«¯å£å—é™é”¥å½¢ NAT";
        } else if (host > 0) {
          natType = "å¼€æ”¾å‹ NAT æˆ–å…¬ç½‘ IP";
        }

        output.textContent = `ä½¿ç”¨ STUN æœåŠ¡å™¨ï¼š${stunServer}
æ£€æµ‹ç»“æœï¼š
æœ¬åœ°å€™é€‰ï¼ˆhostï¼‰ï¼š${host} ä¸ª
æœåŠ¡å™¨åå°„ï¼ˆsrflxï¼‰ï¼š${srflx} ä¸ª
ä¸­ç»§åœ°å€ï¼ˆrelayï¼‰ï¼š${relay} ä¸ª
æ¨æµ‹ NAT ç±»å‹ï¼š${natType}
`;
      }
    }

    function clearResult() {
      const output = document.getElementById('output');
      output.textContent = "ç­‰å¾…æ£€æµ‹...";
    }
  </script>
</body>

</html>